<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='https://vjs.zencdn.net/7.15.4/video-js.css'>
    <script  src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script  src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <script src="https://vjs.zencdn.net/7.15.4/video.js"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://vjs.zencdn.net">
    <title>HTML Gerado Dinamicamente</title>
</head>

<style>
    .video-js {
        width: 100vw;
        height: 100vh;
        flex: 1;
    }
</style>

<body>
    <video id='my-video' class='video-js' controls autoplay>
        <source id='video-source' type='application/x-mpegURL'>
        Seu navegador não suporta o elemento de vídeo.
    </video>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const decryptionKey = '01234567890123456789012345678901';
        var urlParams = new URLSearchParams(window.location.search);
        var encryptedText = urlParams.get('id');
        var keyBytes = new TextEncoder().encode(decryptionKey);
        var encryptedBytes = Uint8Array.from(atob(encryptedText), c => c.charCodeAt(0));

        async function decryptAndPlay() {
            try {
                const key = await crypto.subtle.importKey("raw", keyBytes, { name: "AES-CBC" }, false, ["decrypt"]);
                const decryptedBuffer = await crypto.subtle.decrypt({ name: "AES-CBC", iv: encryptedBytes.slice(0, 16) }, key, encryptedBytes.slice(16));
                var decryptedText = new TextDecoder().decode(decryptedBuffer);

                var player = videojs('my-video', {
                    techOrder: ['html5', 'flash'],
                    html5: {
                        hls: {
                            enableLowInitialPlaylist: true,
                            smoothQualityChange: true,
                            overrideNative: true,
                            // Aqui você pode adicionar outras configurações do hls.js se necessário
                        },
                    },
                    sources: [{
                        src: decryptedText,
                        type: 'application/x-mpegURL',
                    }],
                });
            } catch (error) {
                console.error("Erro na descriptografia:", error);
            }
        }

        decryptAndPlay();
    });
</script>
</body>
