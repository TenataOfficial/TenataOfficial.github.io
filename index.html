<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='https://vjs.zencdn.net/7.15.4/video-js.css'>
    <script  src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script  src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <script src="https://vjs.zencdn.net/7.15.4/video.js"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://vjs.zencdn.net">
    <title>HTML Gerado Dinamicamente</title>
</head>

<style>
    .video-js {
        width: 100vw;
        height: 100vh;
        flex: 1;
    }
</style>

<body>
    <video id='my-video' class='video-js' controls autoplay>
        <source id='video-source' type='application/x-mpegURL'>
        Seu navegador não suporta o elemento de vídeo.
    </video>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const decryptionKey = '01234567890123456789012345678901';

            async function decryptAndPlay() {
                try {
                    var urlParams = new URLSearchParams(window.location.search);
                    var encryptedText = urlParams.get('id');
                    var keyBytes = new TextEncoder().encode(decryptionKey);
                    var decodedText = atob(encryptedText);
                    var encryptedBytes = Uint8Array.from(decodedText, c => c.charCodeAt(0));

                    // Create AES decryption algorithm
                    const key = await crypto.subtle.importKey("raw", keyBytes, { name: "AES-CBC" }, false, ["decrypt"]);
                    const decryptedBuffer = await crypto.subtle.decrypt({ name: "AES-CBC", iv: encryptedBytes.slice(0, 16) }, key, encryptedBytes.slice(16));
                    var decryptedText = new TextDecoder().decode(decryptedBuffer);

                    // Use the decrypted text as the source for the video player
                    var player = videojs('my-video', {
                        techOrder: ['html5', 'flash'],
                        html5: {
                            hls: {
                                enableLowInitialPlaylist: true,
                                smoothQualityChange: true,
                                overrideNative: true,
                                // Aqui você pode adicionar outras configurações do hls.js se necessário
                            },
                        },
                        sources: [{
                            src: decryptedText,
                            type: 'application/x-mpegURL',
                        }],
                    });

                } catch (error) {
                    console.error("Erro na descriptografia:", error);
                }
            }

            decryptAndPlay();
        });
    </script>
</body>

</html>
