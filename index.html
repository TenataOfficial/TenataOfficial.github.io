<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypt and Play Video</title>
</head>
<body>
    <h1>Video Decryption and Playback</h1>

    <label for="decryptionKey">Decryption Key:</label>
    <input type="text" id="decryptionKey">

    <br>

    <button onclick="decryptAndPlayVideo()">Decrypt and Play Video</button>

    <br>

    <video id="videoPlayer" controls width="600">
        Your browser does not support the video tag.
    </video>

    <script>
        function decryptAndPlayVideo() {
            var decryptionKey = document.getElementById("decryptionKey").value;

            // Extract encrypted text from the 'id' parameter in the URL
            var urlParams = new URLSearchParams(window.location.search);
            var encryptedText = urlParams.get('id');

            // Convert key and IV from base64 to Uint8Array
            var keyBytes = new TextEncoder().encode(decryptionKey);
            var encryptedBytes = Uint8Array.from(atob(encryptedText), c => c.charCodeAt(0));

            // Create AES decryption algorithm
            crypto.subtle.importKey("raw", keyBytes, { name: "AES-CBC" }, false, ["decrypt"])
                .then(function (key) {
                    return crypto.subtle.decrypt({ name: "AES-CBC", iv: encryptedBytes.slice(0, 16) }, key, encryptedBytes.slice(16));
                })
                .then(function (decryptedBuffer) {
                    var decryptedText = new TextDecoder().decode(decryptedBuffer);
                    // Use the decrypted text as the source for the video player
                    document.getElementById("videoPlayer").src = decryptedText;
                })
                .catch(function (err) {
                    console.error(err);
                });
        }
    </script>
</body>
</html>
